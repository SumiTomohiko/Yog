--- !ditz.rubyforge.org,2008-03-06/issue 
title: GC in coroutines cause segmentation fault in yog-bdw
desc: "$ cat foo.yg                                    [~/projects/Yog]\n\n\
  co = Coroutine.new() do\n  print(42)\n\
  end\n\
  co.resume()\n\n\
  tom@nymphenburg$ src/yog-bdw --gc-stress foo.yg                [~/projects/Yog]\n\
  GC Warning: Couldn't read /proc/stat\n\
  GC Warning: GC_get_nprocs() returned -1\n\
  zsh: segmentation fault (core dumped)  src/yog-bdw --gc-stress foo.yg\n\
  tom@nymphenburg$ gdb src/yog-bdw core                          [~/projects/Yog]\n\
  GNU gdb 6.8-debian\n\
  Copyright (C) 2008 Free Software Foundation, Inc.\n\
  License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>\n\
  This is free software: you are free to change and redistribute it.\n\
  There is NO WARRANTY, to the extent permitted by law.  Type \"show copying\"\n\
  and \"show warranty\" for details.\n\
  This GDB was configured as \"i486-linux-gnu\"...\n\n\
  warning: Can't read pathname for load map: Input/output error.\n\
  Reading symbols from /lib/tls/i686/cmov/libm.so.6...Reading symbols from /usr/li\n\
  b/debug/lib/tls/i686/cmov/libm-2.7.so...done.\n\
  done.\n\
  Loaded symbols for /lib/tls/i686/cmov/libm.so.6\n\
  Reading symbols from /lib/tls/i686/cmov/libdl.so.2...Reading symbols from /usr/l\n\
  ib/debug/lib/tls/i686/cmov/libdl-2.7.so...done.\n\
  done.\n\
  Loaded symbols for /lib/tls/i686/cmov/libdl.so.2\n\
  Reading symbols from /lib/tls/i686/cmov/libpthread.so.0...Reading symbols from /\n\
  usr/lib/debug/lib/tls/i686/cmov/libpthread-2.7.so...done.\n\
  done.\n\
  Loaded symbols for /lib/tls/i686/cmov/libpthread.so.0\n\
  Reading symbols from /lib/libgcc_s.so.1...Reading symbols from /usr/lib/debug/li\n\
  b/libgcc_s.so.1...done.\n\
  done.\n\
  Loaded symbols for /lib/libgcc_s.so.1\n\
  Reading symbols from /lib/tls/i686/cmov/libc.so.6...Reading symbols from /usr/li\n\
  b/debug/lib/tls/i686/cmov/libc-2.7.so...done.\n\
  done.\n\
  Loaded symbols for /lib/tls/i686/cmov/libc.so.6\n\
  Reading symbols from /lib/ld-linux.so.2...Reading symbols from /usr/lib/debug/li\n\
  b/ld-2.7.so...done.\n\
  done.\n\
  Loaded symbols for /lib/ld-linux.so.2\n\
  Core was generated by `src/yog-bdw --gc-stress foo.yg'.\n\
  Program terminated with signal 11, Segmentation fault.\n\
  [New process 3836]\n\n    top=0x0) at mark.c:1492\n\
  1492            q = (ptr_t)(*p);\n\
  (gdb) bt\n\n    top=0x0) at mark.c:1492\n\n    cold_gc_frame=0xb761dbd4 \"\xEF\xBF\xBD\xEF\xBF\xBDa\xEF\xBF\xBD\xEF\xBF\xBD\xEF\xBF\xBDa\xEF\xBF\xBD\\020\xEF\xBF\xBD\\t\\b\xEF\xBF\xBD\xEF\xBF\xBDa\xEF\xBF\xBD\xEF\xBF\xBD\xEF\xBF\xBDa\xEF\xBF\xBD\\030\xEF\xBF\xBDa\xEF\xBF\xBD\\207\xEF\xBF\xBD\\t\\b\\020\xEF\xBF\xBD\\t\\b\n\
  \") at mark.c:414\n\n    at alloc.c:504\n\n    stop_func=0x809d510 <GC_never_stop_func>) at alloc.c:362\n\n    at alloc.c:762\n\n    keeper=0x807fe10 <YogScriptFrame_keep_children>, finalizer=0, size=52)\n    at gc/bdw.c:32\n\n    keeper=0x807fe10 <YogScriptFrame_keep_children>, finalizer=0, size=52)\n    at gc.c:109\n\n    callee=135698796, self=3, posargc=0 '\\0', posargs=0xb761df50,\n\
  ---Type <return> to continue, or q <return> to quit---\n    kwargc=0 '\\0', kwargs=0x0, vararg=2, varkwarg=2, blockarg=2)\n    at callable.c:334\n\n    posargc=<value optimized out>, posargs=0xb761df50,\n    kwargc=<value optimized out>, kwargs=0x0, vararg=2, varkwarg=2, blockarg=2)\n    at callable.c:655\n\n    argc=<value optimized out>, args=0xb761df50) at callable.c:832\n\n    at coroutine.c:230"
type: :bugfix
component: core
release: 0.42.0
reporter: Sumi Tomohiko <SumiTomohiko@neko-daisuki.ddo.jp>
status: :closed
disposition: :wontfix
creation_time: 2010-04-24 14:55:45.506984 Z
references: []

id: 77d0f5da6a2d504bf8d45b557a7eb24768c14239
log_events: 
- - 2010-04-24 14:55:46.290491 Z
  - Sumi Tomohiko <SumiTomohiko@neko-daisuki.ddo.jp>
  - created
  - ""
- - 2011-07-14 19:21:56.586396 Z
  - Sumi Tomohiko <SumiTomohiko@neko-daisuki.ddo.jp>
  - assigned to release 0.1.0 from unassigned
  - ""
- - 2011-12-29 18:10:37.093209 Z
  - Sumi Tomohiko <SumiTomohiko@neko-daisuki.ddo.jp>
  - closed with disposition wontfix
  - I lost interests for BDW (Bohem GC).
