
YOG_COPYING = yog-copying
YOG_MARK_SWEEP = yog-mark-sweep
YOG_MARK_SWEEP_COMPACT = yog-mark-sweep-compact
YOG_BDW = yog-bdw
YOG_GENERATIONAL = yog-generational
YOG_DIR = src
YOG_COPYING_LIB = $(YOG_DIR)/libyog-copying.la
YOG_MARK_SWEEP_LIB = $(YOG_DIR)/libyog-mark-sweep.la
YOG_MARK_SWEEP_COMPACT_LIB = $(YOG_DIR)/libyog-mark-sweep-compact.la
YOG_BDW_LIB = $(YOG_DIR)/libyog-bdw.la
YOG_GENERATIONAL_LIB = $(YOG_DIR)/libyog-generational.la

ONIG_DIR = onig
ONIG_LIB = $(ONIG_DIR)/libonig.la

BDW_DIR = bdwgc
BDW_LIB = $(BDW_DIR)/libgc.la

all: 
	(cd $(ONIG_DIR); make)
	(cd $(BDW_DIR); make)
	(cd $(YOG_DIR); make)
	./libtool --tag=CC --mode=link $(CC) -o $(YOG_COPYING) $(YOG_COPYING_LIB) $(ONIG_LIB)
	./libtool --tag=CC --mode=link $(CC) -o $(YOG_MARK_SWEEP) $(YOG_MARK_SWEEP_LIB) $(ONIG_LIB)
	./libtool --tag=CC --mode=link $(CC) -o $(YOG_MARK_SWEEP_COMPACT) $(YOG_MARK_SWEEP_COMPACT_LIB) $(ONIG_LIB)
	./libtool --tag=CC --mode=link $(CC) -o $(YOG_BDW) $(YOG_BDW_LIB) $(ONIG_LIB) $(BDW_LIB)
	./libtool --tag=CC --mode=link $(CC) -o $(YOG_GENERATIONAL) $(YOG_GENERATIONAL_LIB) $(ONIG_LIB)

clean: 
	cd $(ONIG_DIR) && make clean
	cd $(BDW_DIR) && make clean
	cd $(YOG_DIR) && make clean

proto: 
	python tools/update_prototype.py

TEST_CMD = py.test

test: 
	make test-copying
	make test-mark-sweep
	make test-mark-sweep-compact
	make test-bdw
	make test-generational
test-copying: 
	GC=copying $(TEST_CMD)
test-mark-sweep: 
	GC=mark-sweep $(TEST_CMD)
test-mark-sweep-compact: 
	GC=mark-sweep-compact $(TEST_CMD)
test-bdw:
	GC=bdw $(TEST_CMD)
test-generational:
	GC=generational $(TEST_CMD)

am--refresh:
	@:
