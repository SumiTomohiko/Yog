
DIRS = @DIRS@
prefix = @prefix@

CONFIG_DISTCLEAN_FILES = config.status config.cache config.log \
			 configure.lineno config.status.lineno

.PHONY: all clean distclean maintainer-clean doc proto test test-bdw test-copying test-mark-sweep test-mark-sweep-compact test-generational update-version install-vim install

all:
	@for subdir in $(DIRS); do \
		(cd $${subdir}; $(MAKE)); \
	done
	cp -f src/yog-copying src/yog

clean:
	@for subdir in $(DIRS) tests; do \
		(cd $${subdir}; $(MAKE) clean); \
	done
	find tests -name "*.pyc" -print0 | xargs --null rm -f
	rm -f core*

distclean:
	@for subdir in $(DIRS) tests; do \
		(cd $${subdir}; $(MAKE) distclean); \
	done
	find tests -name "*.pyc" -print0 | xargs --null rm -f
	rm -f core*
	rm -f $(CONFIG_DISTCLEAN_FILES)
	rm -f Makefile

maintainer-clean:
	@for subdir in $(DIRS) tests; do \
		(cd $${subdir}; $(MAKE) maintainer-clean); \
	done
	find tests -name "*.pyc" -print0 | xargs --null rm -f
	rm -f core*
	rm -f $(CONFIG_DISTCLEAN_FILES)
	rm -rf autom4te.cache
	rm -f Makefile

doc:
	(cd doc && make)

proto:
	python tools/update_prototype.py

test test-installed test-copying test-mark-sweep test-mark-sweep-compact test-bdw test-generational:
	cd tests && $(MAKE) $@

am--refresh:
	@:

update-version:
	cd src && $(MAKE) $@

install-vim:
	cp yog.vim $(prefix)/share/vim/vim71/syntax
	@grep "NOTICE" yog.vim | sed -e 's/" NOTICE: //'

install:
	install src/yog $(prefix)/bin
	cd ext && $(MAKE) $@

# vim: tabstop=8 shiftwidth=8 noexpandtab filetype=automake
