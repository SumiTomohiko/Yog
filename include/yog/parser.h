#if !defined(__YOG_PARSER_H__)
#define __YOG_PARSER_H__

#include <stdio.h>
#include "yog/yog.h"

struct YogToken {
    unsigned int type;
    union {
        ID id;
        YogVal val;
    } u;
    unsigned int lineno;
};

typedef struct YogToken YogToken;

enum YogNodeType {
    NODE_ASSIGN, 
    NODE_ATTR, 
    NODE_BLOCK_ARG, 
    NODE_BLOCK_PARAM, 
    NODE_BREAK, 
    NODE_COMMAND_CALL, 
    NODE_EXCEPT, 
    NODE_EXCEPT_BODY, 
    NODE_FINALLY, 
    NODE_FUNC_CALL, 
    NODE_FUNC_DEF, 
    NODE_IF, 
    NODE_KLASS, 
    NODE_KW_PARAM, 
    NODE_LITERAL, 
    NODE_METHOD_CALL, 
    NODE_NEXT, 
    NODE_NONLOCAL, 
    NODE_PARAM, 
    NODE_RETURN, 
    NODE_SUBSCRIPT, 
    NODE_VARIABLE, 
    NODE_VAR_PARAM, 
    NODE_WHILE, 
};

typedef enum YogNodeType YogNodeType;

struct YogNode {
    YogNodeType type;
    unsigned int lineno;
    union {
        struct {
            struct YogVal left;
            struct YogVal right;
        } assign;
        struct {
            struct YogVal obj;
            ID name;
        } attr;
        struct {
            struct YogVal params;
            struct YogVal stmts;
        } blockarg;
        struct {
            struct YogVal expr;
        } break_;
        struct {
            ID name;
            struct YogVal args;
            struct YogVal blockarg;
        } command_call;
        struct {
            struct YogVal head;
            struct YogVal excepts;
            struct YogVal else_;
        } except;
        struct {
            struct YogVal type;
            ID var;
            struct YogVal stmts;
        } except_body;
        struct {
            struct YogVal head;
            struct YogVal body;
        } finally;
        struct {
            struct YogVal callee;
            struct YogVal args;
            struct YogVal blockarg;
        } func_call;
        struct {
            ID name;
            struct YogVal params;
            struct YogVal stmts;
        } funcdef;
        struct {
            struct YogVal test;
            struct YogVal stmts;
            struct YogVal tail;
        } if_;
        struct {
            ID name;
            struct YogVal super;
            struct YogVal stmts;
        } klass;
        struct {
            struct YogVal val;
        } literal;
        struct {
            struct YogVal recv;
            ID name;
            struct YogVal args;
            struct YogVal blockarg;
        } method_call;
        struct {
            struct YogVal expr;
        } next;
        struct {
            struct YogVal names;
        } nonlocal;
        struct {
            ID name;
            struct YogVal default_;
        } param;
        struct {
            struct YogVal expr;
        } return_;
        struct {
            struct YogVal prefix;
            struct YogVal index;
        } subscript;
        struct {
            ID id;
        } variable;
        struct {
            struct YogVal test;
            struct YogVal stmts;
        } while_;
    } u;
};

#define NO_EXC_VAR  (UINT_MAX)

typedef struct YogNode YogNode;

enum YogLexerState {
    LS_EXPR, 
    LS_NAME, 
    LS_OP, 
};

typedef enum YogLexerState YogLexerState;

struct YogLexer {
    enum YogLexerState state;
    FILE* fp;
    struct YogVal line;
    unsigned int next_index;
    struct YogVal buffer;
    unsigned int lineno;
};

typedef struct YogLexer YogLexer;

/* PROTOTYPE_START */

/**
 * DON'T EDIT THIS AREA. HERE IS GENERATED BY update_prototype.py.
 */

/* src/lexer.c */
YogVal YogLexer_new(YogEnv*);
BOOL YogLexer_next_token(YogEnv*, YogVal, YogVal*);
void YogLexer_read_encoding(YogEnv*, YogVal);

/* src/parser.y */
YogVal YogParser_parse_file(YogEnv*, const char*, BOOL);

/* PROTOTYPE_END */

#endif
/**
 * vim: tabstop=4 shiftwidth=4 expandtab softtabstop=4
 */
