/**
 * This file was generated by "tools/inst.py src/insts.def" automatically.
 * DO NOT TOUCH!!
 */

static void 
CompileData_append_load_special(YogEnv* env, CompileData* data, ID id)
{
    YogInst* inst = inst_new(env);
    inst->type = INST_OP;
    INST_OPCODE(inst) = OP(LOAD_SPECIAL);

    LOAD_SPECIAL_ID(inst) = id;

    append_inst(data, inst);
}

static void 
CompileData_append_push_const(YogEnv* env, CompileData* data, uint8_t index)
{
    YogInst* inst = inst_new(env);
    inst->type = INST_OP;
    INST_OPCODE(inst) = OP(PUSH_CONST);

    PUSH_CONST_INDEX(inst) = index;

    append_inst(data, inst);
}

static void 
CompileData_append_call_method(YogEnv* env, CompileData* data, ID method, uint8_t argc)
{
    YogInst* inst = inst_new(env);
    inst->type = INST_OP;
    INST_OPCODE(inst) = OP(CALL_METHOD);

    CALL_METHOD_METHOD(inst) = method;
    CALL_METHOD_ARGC(inst) = argc;

    append_inst(data, inst);
}

static void 
CompileData_append_store_pkg(YogEnv* env, CompileData* data, ID id)
{
    YogInst* inst = inst_new(env);
    inst->type = INST_OP;
    INST_OPCODE(inst) = OP(STORE_PKG);

    STORE_PKG_ID(inst) = id;

    append_inst(data, inst);
}

static void 
CompileData_append_store_local(YogEnv* env, CompileData* data, uint8_t index)
{
    YogInst* inst = inst_new(env);
    inst->type = INST_OP;
    INST_OPCODE(inst) = OP(STORE_LOCAL);

    STORE_LOCAL_INDEX(inst) = index;

    append_inst(data, inst);
}

static void 
CompileData_append_call_command(YogEnv* env, CompileData* data, ID command, uint8_t argc)
{
    YogInst* inst = inst_new(env);
    inst->type = INST_OP;
    INST_OPCODE(inst) = OP(CALL_COMMAND);

    CALL_COMMAND_COMMAND(inst) = command;
    CALL_COMMAND_ARGC(inst) = argc;

    append_inst(data, inst);
}

static void 
CompileData_append_make_func(YogEnv* env, CompileData* data)
{
    YogInst* inst = inst_new(env);
    inst->type = INST_OP;
    INST_OPCODE(inst) = OP(MAKE_FUNC);


    append_inst(data, inst);
}

static void 
CompileData_append_call_func(YogEnv* env, CompileData* data, uint8_t argc)
{
    YogInst* inst = inst_new(env);
    inst->type = INST_OP;
    INST_OPCODE(inst) = OP(CALL_FUNC);

    CALL_FUNC_ARGC(inst) = argc;

    append_inst(data, inst);
}

static void 
CompileData_append_load_pkg(YogEnv* env, CompileData* data, ID id)
{
    YogInst* inst = inst_new(env);
    inst->type = INST_OP;
    INST_OPCODE(inst) = OP(LOAD_PKG);

    LOAD_PKG_ID(inst) = id;

    append_inst(data, inst);
}

static void 
CompileData_append_load_local(YogEnv* env, CompileData* data, uint8_t index)
{
    YogInst* inst = inst_new(env);
    inst->type = INST_OP;
    INST_OPCODE(inst) = OP(LOAD_LOCAL);

    LOAD_LOCAL_INDEX(inst) = index;

    append_inst(data, inst);
}

static void 
CompileData_append_jump(YogEnv* env, CompileData* data, struct YogInst* dest)
{
    YogInst* inst = inst_new(env);
    inst->type = INST_OP;
    INST_OPCODE(inst) = OP(JUMP);

    JUMP_DEST(inst) = dest;

    append_inst(data, inst);
}

static void 
CompileData_append_jump_if_false(YogEnv* env, CompileData* data, struct YogInst* dest)
{
    YogInst* inst = inst_new(env);
    inst->type = INST_OP;
    INST_OPCODE(inst) = OP(JUMP_IF_FALSE);

    JUMP_IF_FALSE_DEST(inst) = dest;

    append_inst(data, inst);
}


static unsigned int 
get_inst_size(YogInst* inst) 
{
    unsigned int inst2size[] = {
        sizeof(uint8_t) + sizeof(ID), /* load_special */
        sizeof(uint8_t) + sizeof(uint8_t), /* push_const */
        sizeof(uint8_t) + sizeof(ID) + sizeof(uint8_t), /* call_method */
        sizeof(uint8_t) + sizeof(ID), /* store_pkg */
        sizeof(uint8_t) + sizeof(uint8_t), /* store_local */
        sizeof(uint8_t) + sizeof(ID) + sizeof(uint8_t), /* call_command */
        sizeof(uint8_t), /* make_func */
        sizeof(uint8_t) + sizeof(uint8_t), /* call_func */
        sizeof(uint8_t) + sizeof(ID), /* load_pkg */
        sizeof(uint8_t) + sizeof(uint8_t), /* load_local */
        sizeof(uint8_t) + sizeof(pc_t), /* jump */
        sizeof(uint8_t) + sizeof(pc_t), /* jump_if_false */

    };

    return inst2size[INST_OPCODE(inst)];
}

static YogBinary* 
insts2bin(YogEnv* env, YogInst* inst) 
{
#define INIT_BIN_SIZE   (0)
    YogBinary* code = YogBinary_new(env, INIT_BIN_SIZE);
#undef INIT_BIN_SIZE

    while (inst != NULL) {
        if (inst->type == INST_OP) {
            switch (INST_OPCODE(inst)) {

            case OP(LOAD_SPECIAL):
                {
                    YogBinary_push_uint8(env, code, OP(LOAD_SPECIAL));
                    YogBinary_push_id(env, code, LOAD_SPECIAL_ID(inst));
                    break;
                }
            case OP(PUSH_CONST):
                {
                    YogBinary_push_uint8(env, code, OP(PUSH_CONST));
                    YogBinary_push_uint8(env, code, PUSH_CONST_INDEX(inst));
                    break;
                }
            case OP(CALL_METHOD):
                {
                    YogBinary_push_uint8(env, code, OP(CALL_METHOD));
                    YogBinary_push_id(env, code, CALL_METHOD_METHOD(inst));
                    YogBinary_push_uint8(env, code, CALL_METHOD_ARGC(inst));
                    break;
                }
            case OP(STORE_PKG):
                {
                    YogBinary_push_uint8(env, code, OP(STORE_PKG));
                    YogBinary_push_id(env, code, STORE_PKG_ID(inst));
                    break;
                }
            case OP(STORE_LOCAL):
                {
                    YogBinary_push_uint8(env, code, OP(STORE_LOCAL));
                    YogBinary_push_uint8(env, code, STORE_LOCAL_INDEX(inst));
                    break;
                }
            case OP(CALL_COMMAND):
                {
                    YogBinary_push_uint8(env, code, OP(CALL_COMMAND));
                    YogBinary_push_id(env, code, CALL_COMMAND_COMMAND(inst));
                    YogBinary_push_uint8(env, code, CALL_COMMAND_ARGC(inst));
                    break;
                }
            case OP(MAKE_FUNC):
                {
                    YogBinary_push_uint8(env, code, OP(MAKE_FUNC));
                    break;
                }
            case OP(CALL_FUNC):
                {
                    YogBinary_push_uint8(env, code, OP(CALL_FUNC));
                    YogBinary_push_uint8(env, code, CALL_FUNC_ARGC(inst));
                    break;
                }
            case OP(LOAD_PKG):
                {
                    YogBinary_push_uint8(env, code, OP(LOAD_PKG));
                    YogBinary_push_id(env, code, LOAD_PKG_ID(inst));
                    break;
                }
            case OP(LOAD_LOCAL):
                {
                    YogBinary_push_uint8(env, code, OP(LOAD_LOCAL));
                    YogBinary_push_uint8(env, code, LOAD_LOCAL_INDEX(inst));
                    break;
                }
            case OP(JUMP):
                {
                    YogBinary_push_uint8(env, code, OP(JUMP));
                    YogBinary_push_pc(env, code, LABEL_POS(JUMP_DEST(inst)));
                    break;
                }
            case OP(JUMP_IF_FALSE):
                {
                    YogBinary_push_uint8(env, code, OP(JUMP_IF_FALSE));
                    YogBinary_push_pc(env, code, LABEL_POS(JUMP_IF_FALSE_DEST(inst)));
                    break;
                }
            default:
                Yog_assert(env, FALSE, "Unkown instruction.");
                break;
            }
        }

        inst = inst->next;
    }

    return code;
}

/**
 * vim: tabstop=4 shiftwidth=4 expandtab softtabstop=4 filetype=c
 */
